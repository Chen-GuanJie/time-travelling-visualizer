/* Copyright 2016 The TensorFlow Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
==============================================================================*/
import * as THREE from 'three';
import * as util from './util';
const FONT_SIZE = 80;
const ONE_OVER_FONT_SIZE = 1 / FONT_SIZE;
const LABEL_SCALE = 2.2; // at 1:1 texel/pixel ratio
const LABEL_COLOR = 'black';
const LABEL_BACKGROUND = 'white';
const MAX_CANVAS_DIMENSION = 8192;
const NUM_GLYPHS = 256;
const RGB_ELEMENTS_PER_ENTRY = 3;
const XYZ_ELEMENTS_PER_ENTRY = 3;
const UV_ELEMENTS_PER_ENTRY = 2;
const VERTICES_PER_GLYPH = 2 * 3; // 2 triangles, 3 verts per triangle
/**
 * Each label is made up of triangles (two per letter.) Each vertex, then, is
 * the corner of one of these triangles (and thus the corner of a letter
 * rectangle.)
 * Each has the following attributes:
 *    posObj: The (x, y) position of the vertex within the label, where the
 *            bottom center of the word is positioned at (0, 0);
 *    position: The position of the label in worldspace.
 *    vUv: The (u, v) coordinates that index into the glyphs sheet (range 0, 1.)
 *    color: The color of the label (matches the corresponding point's color.)
 *    wordShown: Boolean. Whether or not the label is visible.
 */
const VERTEX_SHADER = `
    attribute vec2 posObj;
    attribute vec3 color;
    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      vUv = uv;
      vColor = color;

      // Rotate label to face camera.

      vec4 vRight = vec4(
        modelViewMatrix[0][0], modelViewMatrix[1][0], modelViewMatrix[2][0], 0);

      vec4 vUp = vec4(
        modelViewMatrix[0][1], modelViewMatrix[1][1], modelViewMatrix[2][1], 0);

      vec4 vAt = -vec4(
        modelViewMatrix[0][2], modelViewMatrix[1][2], modelViewMatrix[2][2], 0);

      mat4 pointToCamera = mat4(vRight, vUp, vAt, vec4(0, 0, 0, 1));

      vec2 scaledPos = posObj * ${ONE_OVER_FONT_SIZE} * ${LABEL_SCALE};

      vec4 posRotated = pointToCamera * vec4(scaledPos, 0, 1);
      vec4 mvPosition = modelViewMatrix * (vec4(position, 0) + posRotated);
      gl_Position = projectionMatrix * mvPosition;
    }`;
const FRAGMENT_SHADER = `
    uniform sampler2D texture;
    uniform bool picking;
    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      if (picking) {
        gl_FragColor = vec4(vColor, 1.0);
      } else {
        vec4 fromTexture = texture2D(texture, vUv);
        gl_FragColor = vec4(vColor, 1.0) * fromTexture;
      }
    }`;
/**
 * Renders the text labels as 3d geometry in the world.
 */
export class scatterPlotVisualizerTriangles {
    createGlyphTexture() {
        let canvas = document.createElement('canvas');
        canvas.width = MAX_CANVAS_DIMENSION;
        canvas.height = FONT_SIZE;
        let ctx = canvas.getContext('2d');
        ctx.font = 'bold ' + FONT_SIZE * 0.75 + 'px roboto';
        ctx.textBaseline = 'top';
        ctx.fillStyle = LABEL_BACKGROUND;
        ctx.rect(0, 0, canvas.width, canvas.height);
        ctx.fill();
        ctx.fillStyle = LABEL_COLOR;
        let spaceOffset = ctx.measureText(' ').width;
        // For each letter, store length, position at the encoded index.
        let glyphLengths = new Float32Array(NUM_GLYPHS);
        let glyphOffset = new Float32Array(NUM_GLYPHS);
        let leftCoord = 0;
        for (let i = 0; i < NUM_GLYPHS; i++) {
            let text = ' ' + String.fromCharCode(i);
            let textLength = ctx.measureText(text).width;
            glyphLengths[i] = textLength - spaceOffset;
            glyphOffset[i] = leftCoord;
            ctx.fillText(text, leftCoord - spaceOffset, 0);
            leftCoord += textLength;
        }
        const tex = util.createTexture(canvas);
        return { texture: tex, lengths: glyphLengths, offsets: glyphOffset };
    }
    processLabelVerts(pointCount) {
        let numTotalLetters = 0;
        this.labelVertexMap = [];
        for (let i = 0; i < pointCount; i++) {
            const label = '13';
            let vertsArray = [];
            for (let j = 0; j < label.length; j++) {
                for (let k = 0; k < VERTICES_PER_GLYPH; k++) {
                    vertsArray.push(numTotalLetters * VERTICES_PER_GLYPH + k);
                }
                numTotalLetters++;
            }
            this.labelVertexMap.push(vertsArray);
        }
        this.totalVertexCount = numTotalLetters * VERTICES_PER_GLYPH;
    }
    createColorBuffers(pointCount) {
        this.pickingColors = new Float32Array(this.totalVertexCount * RGB_ELEMENTS_PER_ENTRY);
        this.renderColors = new Float32Array(this.totalVertexCount * RGB_ELEMENTS_PER_ENTRY);
        for (let i = 0; i < pointCount; i++) {
            let color = new THREE.Color(i);
            this.labelVertexMap[i].forEach((j) => {
                this.pickingColors[RGB_ELEMENTS_PER_ENTRY * j] = color.r;
                this.pickingColors[RGB_ELEMENTS_PER_ENTRY * j + 1] = color.g;
                this.pickingColors[RGB_ELEMENTS_PER_ENTRY * j + 2] = color.b;
                this.renderColors[RGB_ELEMENTS_PER_ENTRY * j] = 1;
                this.renderColors[RGB_ELEMENTS_PER_ENTRY * j + 1] = 1;
                this.renderColors[RGB_ELEMENTS_PER_ENTRY * j + 2] = 1;
            });
        }
    }
    addbackgroundImg(imgUrl) {
        //移除上一个画布
        if (window.backgroundMesh) {
            this.scene.remove(window.backgroundMesh);
        }
        if (!imgUrl) {
            return;
        }
        // 2，使用canvas画图作为纹理贴图
        // 先使用canvas画图
        let canvas = document.createElement('canvas');
        canvas.width = 200;
        canvas.height = 200;
        var ctx = canvas.getContext("2d");
        var img = new Image();
        img.src = imgUrl;
        img.crossOrigin = "anonymous";
        img.onload = () => {
            ctx.drawImage(img, 0, 0, 200, 200);
            let texture = new THREE.CanvasTexture(canvas);
            // texture.needsUpdate = true; // 不设置needsUpdate为true的话，可能纹理贴图不刷新
            var plane_geometry = new THREE.PlaneGeometry(2, 2);
            var material = new THREE.MeshPhongMaterial({
                // color:0x11ff22,
                map: texture,
                side: THREE.DoubleSide
            });
            window.backgroundMesh = new THREE.Mesh(plane_geometry, material);
            this.scene.add(window.backgroundMesh);
        };
    }
    createTriangles() {
        // if (window.sceneBackgroundImg[window.iteration]) {
        //   this.addbackgroundImg('data:image/png;base64,' + window.sceneBackgroundImg[window.iteration])
        // }
        // this.addbackgroundImg('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAwCAYAAABJy8k0AAAAAXNSR0IArs4c6QAAD4dJREFUaEOtWmlzI8l1zEaf6MYNksO5Q5IjFKH/bCl8/Az50A/wrqVPki1rY7XrmZ0ZDgni6rvhyFdV3dUAyOGuzA0uQHAIMivz5bvK+fVvvzocwA/9f3k4QL+Ig/nuQV7Vr6vHBgc4R4/qn6vv82f52cij+lqeN+a1A+pDg4Zfy2sNanneoK4bVPJYq5+1/kYHDhwHGAwGcAcDBL6HwPPka98dwPc9DACUVYW0qFDWNYqqlvfl3+AAcH79L19pbF8ATjj6LzAHYIALIL7Z0eMxcHUAfeACkj/XqAMQ4DyAukbFr+sajT5Mwc7fYwH3XRdh4At4b+DCdQcI5bkjgNO8RFaWKKsaRVnJwT8CXINU3Mlxq9+tmdOMEricoLDeAe9U0jErCjnwxPk2GiRfExYU01RCzYNoDqjqWj2v5bd0fwN/D9l2HMWw72EY+ALedz14riOvha4rP5/mhYBPywpFUcr7EssDjD8CXDNvpP504ErO3QFQ5lrimmXFOA+lQVXzADRwHrihWwN3HEdkHvk+ojAQ8GTd9QYIXA9h4AkpWV5in2nwRY7csH5e6l8GToaNlA3jNtP8O21p809XwKkCSGzziS1z/ntKWxhvamFblGAMR8NXUnfgea4AH0YEHghYsh24LqIgEGVkRYk0y7FNc+yyXL5mCAjjSkl2jP/twPlu5mBsMzMGR8A2cCV1zfKJ1DvDlPh0OuBkOolCAR8GASIxOhdhGMB1HJRlhW2WY5NmAn6fKdYt4A+4uYlt61EB6ru3UYD6Z+oYzwE3KhBZa1Pjv1MS76Reku1ayZ4/Y38o4IDveYjDAPEwRBKGGGrJ09zC0BcPoIJ2WYH7XSrg92mGLC9+KnCjCCtNGdc/A9xI/Did9WWugTON0fwquvqx1LWra+BMYWQ7GYaII/VJyQ9DSp5mN5CD22cl7rY7rHd7Ac+DcH7DdKYMu5+/j928x7zJ6V0+N3n6HONdbKt4NTLvUplmmoB1XDMODeNGPZLKNOiBo/I3wY7I+DBqJW9cPvQGKOsD0qzA3XaPu80Wm32KXSrAv1bC7BUoZ9LY/yNwA/g4xuV1OrrO33R2U3QYqR+YyuBIvlbGFmI8JPhIJM9HSj7yXQS+L+mLsb3a7nGzWmO9p9zzHwvcPhCbbZXLTSHzUIwrECqfn6YyS+qSzoyr0z1UncAPVmTi6AQeqPhWwIci+bEcQICIed33UFeNgF1td/h8t8H9bi8HIYy3JaYdp2elbrv/TwNuytfTik2ZmF2xGcZVceTg4Bws4C6Goa+BRxjHQyRxhIlm3uR1HuD9VgG/ud/gfrPDZp/B+c2/fn2w63GpznRdbNfrxlftXN3W37pmfwrjAu4oldluTqkrR1eMV1IZdq5+YMUG7ehRILFNlpNkKKDHcYTRMEAchsJ4WVfYbPa422b4tN5gdb8V1k+BHzUitlmZ5+1rVoPS1uWPpDNK3KQxxrd6ruKYedxUanRzI/VGNN60UqfMBbjvYUQn1/IeJzEmAjrCKA6RRBGiwENeVVgT+CbF580Gn1cbiffO3JSpn3RgXwJ+0ok9Clx3XrpUBQHqXH7clVWVqtUlj1tJfEBrcw7SiJBtOvooHgrTEy33cRyK9Ie+j6KqBKgAX29wc7eW1PY04GfbVFPp2bncakftAsbU5AakDbztxvrNSWtuInXWayaHH6QwYSoTdoehAB5R6nGkDC4ZYhrHiKNADm+1YXxv5fPTao3b9fbpwE2HdlyP23FuKroTV/8S8LZUVc2JFC5VjZI613Qb3lmGEji7MQKno0+SobBO4LE8hpgmiUieFd56u8f723vcrrb4sFpLWmsLGO1nvRawBWk5/OPArTK17d9Va6oGDar1lMqMnYrO2dKNaVmbwsVm3C5XGd+e50m6Mi4uhkbAcgBK5rMkxjSO4HsDrNMU7z7d4+PdBh/v+GgDt6cc+rld2DyN8UeAa/CPARcXlwFEx3jXmXUpjaUqmxIy3jq5SJ2xTuAxpqMhFkmIyB9gm1Z4d3uP97cb/HC7wg+fV7pWb43ty2XrOcbNJIZpyri7eLGKg7Y9NcOGhxhvgesDqGtOdhqJcWNwrbFJja7SF9MZ41qAJyqnE/gy8THyB9gVDd6vU7z/tML3N3d49+knADd53s79NnDmXMnTZ4AbuStZn0qdwCl1YV03KYfW2BR0ujr7bppYC5zgCTaJBfiUsifwoYfEc5A3wO2+xF8/3eG7j3f4/tPn0+5Ml+RHDYseO1n1er+p6Q8X+8DNyKmLcwJXeVzV5SbGW+AErSWvgHcJjXlc9eCRxLikMUqejI8U05M4xmwcYx4OEA7U2GxX1Pj24xrffLjFtx9vngr8aO520s31U5qAskdUetZmems1VdUjpi8CN2lTpTRvABk4jCR1MXcr8Exfk3GE2SiWzwWNLnTga2fM6gZ/vdnhLx9u8d0P54BbJteWrGfqdsO4GTI+mNasIeOPBc6WUo7QyuOu60j3ZRoTHsBE5E2Wh5hPx1iOYixjH6HLiaz6qBrg3TrH/3y4wbf/+wnO+bn6kcnZw752uqId0WK2V6u3RtfN3jrgZpb+uNQZ712MKwA+gUsPrk0tDjFKYswJdjbC5WyMxSjCJBjA4w8QuZ4C32U1/vz+M/78/ceHgZtU9lDJ2p/TnQ4k2rGTMK6HjHqM9FSpK+DdKoFVeuANMAxZpqoWVGQ+SjToKa6nCRaabTkpAS4DZaRVg//6cIf//q5lXHc/Z2VuGVtvvHTKuJqzW7lcz+Za4LpwMfPzL5lbUanNR1euOgh9VzPOUjUSJ19MR1jOxnixmOJyGmPiq0ZGmWKt0XtipN98WuOP39/A+fvfftXBbX+HtUKynNywbz8a5u1xcx98tzoy3Vm7OJCNycOuTuD2oJFLBAI3HRmdfDkh6Amu52M8v5jgIg4QtKV9iqbJVRIcxGgOLt7fZ/gTY7wF3sLvpiw9oA8egGLeAOckxi5k7J2ZbFJMOyqro4eBl1UjnVWP8QFkmEjgLFaWY0p8jMv5BC+XMzybDTENXG1o3JVtUddbYdx1x3AGMdaZgz++E8b/w2yHtKJO2W5FbZlcb3hhrZR+HHBOXExaU+NkKWC456prlCX3Zp3UyTinLuzIZqNEjOxyPsXz5RQvyXYSSt6WdeYhRV1vUJZ7KZZ8fwjPW6JBiD+9u9XAH2K7l8a005vjMaZjTWePl4gyXeV/7QZF9+PtAOIx4BXKUg0fzQe7siT0pTxdThI8m89wfTHHy4spns9jTEO1JT0cSjTNPcqSwDPUdYXBgJ3bM7hegm8+bhVwe15vu6jZ1LULQ/MXnGxe+mtjk9b+FuBc8TLGe8AdB8kwkJbzaj7Gi+UMLy4XeHUxw7NxiMhTVd7hsENRrFCUW1RlgarK4TgeRqNL+P4lfrivj4HbMu9vKNtZnAVah31b3p4wbq2Fze6M0jUtqIyeHpA6gecEXot7yJFzScg0thiPcLWY4NXlAq+fLfDmYoZp5MJ3yDYlfo88J+O5fFZVIXIfxhMk8Rtsy+SJwM8wbINW1Vt3UaBl3OrW5DXdkz8FOGdljHEyLgbJlRGBj4a4mo7wfDkT4G8JfDFCLKbGAeUWef4ZZblTwKsClZZ7ECSYTn8BJ7joXF3evF2E20vDx/J45+hngZsYbwsYM5RQlZu68cCUpdfClrkZ4DJihhorcwAxHw/xTAxthtdXC7y9XuDFZIjIG+CADFW5QpreSmwrtvVjXWLg+FguXyMZv+0D71VpxsFtaT/K/BnGbXPTa2I1jTnak0n/reJZuTplzhsMZFBdBWFXFgQ+LiYxrhdTiW2R+eUcV6MA4cBB1WxQFjdI07UGbsAr5imbyeQSy+XfHQM3Nx5O21Bb2udlfnoVpLcf1wOJh4ErWZt0ZoAztZFxj5cAwhBXswTXWuZvrpd4dTXDMnDhOgdU1QpZ9hF5tkMhjKcW8zmapsJwOMPV5a8UcNvWewsDu2g5w7aJbZ052ysh5j3slXA7d29vP5gdmbn5oIaLMoCoDjIPl/iUspUyd6UjY7FCN395tcSb6wXeLKcY+yxRSpTlHdL0BpkNvCB4fuaomwq+F+Hq6pfsx78+UHrqo3/byU5jx9tU4+DHoI/fwwwa1YpYV26tsytXV4sEG3itgJeqkKF/cJzMEvV6McGLyzleXl3g51czvJ4n8F3+FXtJYfv0Dlm2RVFkKAu+Rub3Ot5LOM4Ay+UrOP/wb/95YHzxAs7j/ff5W1EPHUCPde3m52t1c62rX7kROGNcdWiQnfd8nOD5YoaXl3O8ur7Azy9nuJ6EcCWNEewd9uk9snSDvNijLFIUBE/G5QByKa4n4yWcf/rd7w9qyKc6oZNbTl+o1Pjt41tP3XZFb2aOgJu2VC3+9WfVKKmbklUD5/00Ojp78Msp43subs74fnsxwzL2MHCo1DXynFK/R0rg+Q45ZV7s9WOGqmKOrxCGCZx//t0fDmpLyZOvVXn5xNjuLvh1xnbcwclS/wi4GTYeX+STZYIAZ4wXKFiy1jXvdmEcRbiaj/DiYo5XV0u8fX6B18sJpgGvAjElrpFnhvF7ZPkeeU7g3QGo8rXAYBCQ8T+IbUle1RtKswnpg+jqVRMSpv/mz5/efOo8Q8W3inGTv9tFoYlxvTkxjFPqeVnjUDdwXReTJMQ18/flHG8J/MUSr2YjRDJeYiemGN/vyfgaWb5FnjHGWb6mWvoETrmjAy6bW51OGpl1ddes+vM1+yqnOgxzo/F8HdBd6TwPXK+DaW4t47WA5o1E/m7eZOI8jYXLS1Zr10v84tkC19OhxDdQSVOSZSvs9zQ4Pt8hF5NjnHess3wlERLj7ZZEr2pFivpG4UNurvJAx3RPHSZU2u1rd7GvV5+be20asAAn88J2I8D5O5IokIHDs4UBrhz9chTo3tsAv8VuR8b5ydKVJpei0PFOo2PTQiN3/vHff69Dutt+mlgzAwXK2BjWY4DPFTlGOXat3jUm5gaEBqyNjUOItCqkLeWSkFc7rjhlWU7xWvL3BX62nGA2lDzG67rSmGSZAr7fr5GR9VwxTqNTzO9RVjkOTaWAHxcw0kHpWwniwD1m+7leHUk7aNc6aF9sv6cWJ2qUZJuaKVVZphIw05eROQ+IV7Y4W7timXoxE2P72fMLvJyOMAqM7xD4Cml2i/1uhZ2Jc5H6DkWu05ouZuqmVnn8hCl2teY+KUtGuZV85rLukft3N2T0JYN2wqkGneZqtvKS/p1VmbpomWdFdRTfuj')
        var _a;
        if (!window.customSelection) {
            window.customSelection = [];
        }
        else {
            function func(a, b) {
                return a - b;
            }
            window.customSelection.sort(func);
            console.log('cuscus', window.customSelection);
        }
        if (!this.unLabelDataIndexList) {
            this.unLabelDataIndexList = [];
        }
        window.selectedList = this.selectedIndexList;
        if (this.worldSpacePointPositions == null) {
            return;
        }
        const pointCount = ((_a = this.worldSpacePointPositions) === null || _a === void 0 ? void 0 : _a.length) / XYZ_ELEMENTS_PER_ENTRY;
        this.glyphTexture = this.createGlyphTexture();
        this.uniforms = {
            texture: { type: 't' },
            picking: { type: 'bool' },
        };
        this.material = new THREE.ShaderMaterial({
            uniforms: this.uniforms,
            transparent: true,
            vertexShader: VERTEX_SHADER,
            fragmentShader: FRAGMENT_SHADER,
        });
        this.processLabelVerts(pointCount);
        this.createColorBuffers(pointCount);
        let positionArray = new Float32Array(this.totalVertexCount * XYZ_ELEMENTS_PER_ENTRY);
        this.positions = new THREE.BufferAttribute(positionArray, XYZ_ELEMENTS_PER_ENTRY);
        let posArray = new Float32Array(this.totalVertexCount * XYZ_ELEMENTS_PER_ENTRY);
        let colorsArray = new Float32Array(this.totalVertexCount * RGB_ELEMENTS_PER_ENTRY);
        let positionObject = new THREE.BufferAttribute(posArray, 2);
        let colors = new THREE.BufferAttribute(colorsArray, RGB_ELEMENTS_PER_ENTRY);
        this.geometry = new THREE.BufferGeometry();
        this.geometry.addAttribute('posObj', positionObject);
        this.geometry.addAttribute('position', this.positions);
        this.geometry.addAttribute('color', colors);
        let lettersSoFar = 0;
        console.log('selectedIndexList', this.selectedIndexList, this.glyphTexture);
        for (let i = 0; i < pointCount * 2; i++) {
            let leftOffset = 0;
            leftOffset += this.glyphTexture.lengths[105];
            // Determine length of word in pixels.
            leftOffset /= -2; // centers text horizontally around the origin
            let letterWidth = this.glyphTexture.lengths[105];
            let scale = FONT_SIZE;
            let right = (leftOffset + letterWidth) / scale;
            let triRight = (leftOffset + this.glyphTexture.lengths[115]) / scale;
            let left = leftOffset / scale;
            let top = 40 / scale;
            if (window.unLabelData.indexOf(Math.floor(i / 2)) !== -1) {
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 0, left, left);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 1, -left, left);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 2, 0, top / 4);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 0, left, left);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 1, -left, left);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 2, 0, top / 4);
            }
            else if (window.testingData.indexOf(Math.floor(i / 2)) !== -1) {
                //juxing
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 0, left / 2, left / 2);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 1, -left / 2, left / 2);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 2, left / 2, -left / 2);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 3, left / 2, -left / 2);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 4, -left / 2, left / 2);
                positionObject.setXY(lettersSoFar * VERTICES_PER_GLYPH + 5, -left / 2, -left / 2);
            }
            lettersSoFar++;
            leftOffset += letterWidth;
        }
        for (let i = 0; i < pointCount; i++) {
            const p = util.vector3FromPackedArray(this.worldSpacePointPositions, i);
            this.labelVertexMap[i].forEach((j) => {
                this.positions.setXYZ(j, p.x, p.y, p.z);
            });
        }
        this.pointsMesh = new THREE.Mesh(this.geometry, this.material);
        this.pointsMesh.frustumCulled = false;
        this.scene.add(this.pointsMesh);
    }
    colorLabels(pointColors) {
        if (this.geometry == null ||
            pointColors == null) {
            return;
        }
        const colors = this.geometry.getAttribute('color');
        colors.setArray(this.renderColors);
        const n = pointColors.length / XYZ_ELEMENTS_PER_ENTRY;
        let src = 0;
        for (let i = 0; i < n; ++i) {
            const c = new THREE.Color(pointColors[src], pointColors[src + 1], pointColors[src + 2]);
            const m = this.labelVertexMap[i].length;
            for (let j = 0; j < m; ++j) {
                colors.setXYZ(this.labelVertexMap[i][j], c.r, c.g, c.b);
            }
            src += RGB_ELEMENTS_PER_ENTRY;
        }
        colors.needsUpdate = true;
    }
    setScene(scene) {
        this.scene = scene;
    }
    /** Set the labels to rendered */
    setLabels(labels) {
        this.labels = labels;
    }
    dispose() {
        if (this.pointsMesh) {
            if (this.scene) {
                this.scene.remove(this.pointsMesh);
            }
            this.pointsMesh = null;
        }
        if (this.geometry) {
            this.geometry.dispose();
            this.geometry = null;
        }
        if (this.glyphTexture != null && this.glyphTexture.texture != null) {
            this.glyphTexture.texture.dispose();
            this.glyphTexture.texture = null;
        }
    }
    onPickingRender(rc) {
        if (this.geometry == null) {
            this.createTriangles();
        }
        if (this.geometry == null) {
            return;
        }
        this.material.uniforms.texture.value = this.glyphTexture.texture;
        this.material.uniforms.picking.value = true;
        const colors = this.geometry.getAttribute('color');
        colors.setArray(this.pickingColors);
        colors.needsUpdate = true;
    }
    onRender(rc) {
        if (this.geometry == null) {
            this.createTriangles();
        }
        if (this.geometry == null) {
            return;
        }
        this.colorLabels(rc.pointColors);
        this.material.uniforms.texture.value = this.glyphTexture.texture;
        this.material.uniforms.picking.value = false;
        const colors = this.geometry.getAttribute('color');
        colors.setArray(this.renderColors);
        colors.needsUpdate = true;
    }
    onPointPositionsChanged(newPositions) {
        this.worldSpacePointPositions = newPositions;
        this.dispose();
    }
    // setLabelStrings(labelStrings: string[]) {
    //   this.labelStrings = labelStrings;
    //   this.dispose();
    // }
    setSelectedPoint(selectedIndexList) {
        this.selectedIndexList = selectedIndexList;
    }
    setUnLabeledIndex(list) {
        this.unLabelDataIndexList = list;
    }
    onResize(newWidth, newHeight) { }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NhdHRlclBsb3RWaXN1YWxpemVyVHJpYW5nbGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vdGVuc29yYm9hcmQvcHJvamVjdG9yL3NjYXR0ZXJQbG90VmlzdWFsaXplclRyaWFuZ2xlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztnRkFhZ0Y7QUFDaEYsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFLL0IsT0FBTyxLQUFLLElBQUksTUFBTSxRQUFRLENBQUM7QUFPL0IsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ3JCLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQztBQUN6QyxNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsQ0FBQywyQkFBMkI7QUFDcEQsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDO0FBQzVCLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDO0FBQ2pDLE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxDQUFDO0FBQ2xDLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQztBQUN2QixNQUFNLHNCQUFzQixHQUFHLENBQUMsQ0FBQztBQUNqQyxNQUFNLHNCQUFzQixHQUFHLENBQUMsQ0FBQztBQUNqQyxNQUFNLHFCQUFxQixHQUFHLENBQUMsQ0FBQztBQUNoQyxNQUFNLGtCQUFrQixHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxvQ0FBb0M7QUFDdEU7Ozs7Ozs7Ozs7O0dBV0c7QUFDSCxNQUFNLGFBQWEsR0FBRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7a0NBdUJZLGtCQUFrQixNQUFNLFdBQVc7Ozs7O01BSy9ELENBQUM7QUFDUCxNQUFNLGVBQWUsR0FBRzs7Ozs7Ozs7Ozs7OztNQWFsQixDQUFDO0FBTVA7O0dBRUc7QUFDSCxNQUFNLE9BQU8sOEJBQThCO0lBaUJqQyxrQkFBa0I7UUFDeEIsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFB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Q3RDLG9CQUFvQjtJQUNwQixJQUFJO0lBQ0osZ0JBQWdCLENBQUMsaUJBQTJCO1FBQzFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQTtJQUM1QyxDQUFDO0lBQ0QsaUJBQWlCLENBQUMsSUFBYztRQUM5QixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFBO0lBQ2xDLENBQUM7SUFDRCxRQUFRLENBQUMsUUFBZ0IsRUFBRSxTQUFpQixJQUFJLENBQUM7Q0FDbEQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBDb3B5cmlnaHQgMjAxNiBUaGUgVGVuc29yRmxvdyBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovXG5pbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7XG5cbmltcG9ydCB7IENhbWVyYVR5cGUsUmVuZGVyQ29udGV4dCxMYWJlbFJlbmRlclBhcmFtcyB9IGZyb20gJy4vcmVuZGVyQ29udGV4dCc7XG5cbmltcG9ydCB7IFNjYXR0ZXJQbG90VmlzdWFsaXplciB9IGZyb20gJy4vc2NhdHRlclBsb3RWaXN1YWxpemVyJztcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlsJztcblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICBzZWxlY3RlZExpc3Q6IGFueSxcbiAgfVxufVxuY29uc3QgRk9OVF9TSVpFID0gODA7XG5jb25zdCBPTkVfT1ZFUl9GT05UX1NJWkUgPSAxIC8gRk9OVF9TSVpFO1xuY29uc3QgTEFCRUxfU0NBTEUgPSAyLjI7IC8vIGF0IDE6MSB0ZXhlbC9waXhlbCByYXRpb1xuY29uc3QgTEFCRUxfQ09MT1IgPSAnYmxhY2snO1xuY29uc3QgTEFCRUxfQkFDS0dST1VORCA9ICd3aGl0ZSc7XG5jb25zdCBNQVhfQ0FOVkFTX0RJTUVOU0lPTiA9IDgxOTI7XG5jb25zdCBOVU1fR0xZUEhTID0gMjU2O1xuY29uc3QgUkdCX0VMRU1FTlRTX1BFUl9FTlRSWSA9IDM7XG5jb25zdCBYWVpfRUxFTUVOVFNfUEVSX0VOVFJZID0gMztcbmNvbnN0IFVWX0VMRU1FTlRTX1BFUl9FTlRSWSA9IDI7XG5jb25zdCBWRVJUSUNFU19QRVJfR0xZUEggPSAyICogMzsgLy8gMiB0cmlhbmdsZXMsIDMgdmVydHMgcGVyIHRyaWFuZ2xlXG4vKipcbiAqIEVhY2ggbGFiZWwgaXMgbWFkZSB1cCBvZiB0cmlhbmdsZXMgKHR3byBwZXIgbGV0dGVyLikgRWFjaCB2ZXJ0ZXgsIHRoZW4sIGlzXG4gKiB0aGUgY29ybmVyIG9mIG9uZSBvZiB0aGVzZSB0cmlhbmdsZXMgKGFuZCB0aHVzIHRoZSBjb3JuZXIgb2YgYSBsZXR0ZXJcbiAqIHJlY3RhbmdsZS4pXG4gKiBFYWNoIGhhcyB0aGUgZm9sbG93aW5nIGF0dHJpYnV0ZXM6XG4gKiAgICBwb3NPYmo6IFRoZSAoeCwgeSkgcG9zaXRpb24gb2YgdGhlIHZlcnRleCB3aXRoaW4gdGhlIGxhYmVsLCB3aGVyZSB0aGVcbiAqICAgICAgICAgICAgYm90dG9tIGNlbnRlciBvZiB0aGUgd29yZCBpcyBwb3NpdGlvbmVkIGF0ICgwLCAwKTtcbiAqICAgIHBvc2l0aW9uOiBUaGUgcG9zaXRpb24gb2YgdGhlIGxhYmVsIGluIHdvcmxkc3BhY2UuXG4gKiAgICB2VXY6IFRoZSAodSwgdikgY29vcmRpbmF0ZXMgdGhhdCBpbmRleCBpbnRvIHRoZSBnbHlwaHMgc2hlZXQgKHJhbmdlIDAsIDEuKVxuICogICAgY29sb3I6IFRoZSBjb2xvciBvZiB0aGUgbGFiZWwgKG1hdGNoZXMgdGhlIGNvcnJlc3BvbmRpbmcgcG9pbnQncyBjb2xvci4pXG4gKiAgICB3b3JkU2hvd246IEJvb2xlYW4uIFdoZXRoZXIgb3Igbm90IHRoZSBsYWJlbCBpcyB2aXNpYmxlLlxuICovXG5jb25zdCBWRVJURVhfU0hBREVSID0gYFxuICAgIGF0dHJpYnV0ZSB2ZWMyIHBvc09iajtcbiAgICBhdHRyaWJ1dGUgdmVjMyBjb2xvcjtcbiAgICB2YXJ5aW5nIHZlYzIgdlV2O1xuICAgIHZhcnlpbmcgdmVjMyB2Q29sb3I7XG5cbiAgICB2b2lkIG1haW4oKSB7XG4gICAgICB2VXYgPSB1djtcbiAgICAgIHZDb2xvciA9IGNvbG9yO1xuXG4gICAgICAvLyBSb3RhdGUgbGFiZWwgdG8gZmFjZSBjYW1lcmEuXG5cbiAgICAgIHZlYzQgdlJpZ2h0ID0gdmVjNChcbiAgICAgICAgbW9kZWxWaWV3TWF0cml4WzBdWzBdLCBtb2RlbFZpZXdNYXRyaXhbMV1bMF0sIG1vZGVsVmlld01hdHJpeFsyXVswXSwgMCk7XG5cbiAgICAgIHZlYzQgdlVwID0gdmVjNChcbiAgICAgICAgbW9kZWxWaWV3TWF0cml4WzBdWzFdLCBtb2RlbFZpZXdNYXRyaXhbMV1bMV0sIG1vZGVsVmlld01hdHJpeFsyXVsxXSwgMCk7XG5cbiAgICAgIHZlYzQgdkF0ID0gLXZlYzQoXG4gICAgICAgIG1vZGVsVmlld01hdHJpeFswXVsyXSwgbW9kZWxWaWV3TWF0cml4WzFdWzJdLCBtb2RlbFZpZXdNYXRyaXhbMl1bMl0sIDApO1xuXG4gICAgICBtYXQ0IHBvaW50VG9DYW1lcmEgPSBtYXQ0KHZSaWdodCwgdlVwLCB2QXQsIHZlYzQoMCwgMCwgMCwgMSkpO1xuXG4gICAgICB2ZWMyIHNjYWxlZFBvcyA9IHBvc09iaiAqICR7T05FX09WRVJfRk9OVF9TSVpFfSAqICR7TEFCRUxfU0NBTEV9O1xuXG4gICAgICB2ZWM0IHBvc1JvdGF0ZWQgPSBwb2ludFRvQ2FtZXJhICogdmVjNChzY2FsZWRQb3MsIDAsIDEpO1xuICAgICAgdmVjNCBtdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4ICogKHZlYzQocG9zaXRpb24sIDApICsgcG9zUm90YXRlZCk7XG4gICAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuICAgIH1gO1xuY29uc3QgRlJBR01FTlRfU0hBREVSID0gYFxuICAgIHVuaWZvcm0gc2FtcGxlcjJEIHRleHR1cmU7XG4gICAgdW5pZm9ybSBib29sIHBpY2tpbmc7XG4gICAgdmFyeWluZyB2ZWMyIHZVdjtcbiAgICB2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuXG4gICAgdm9pZCBtYWluKCkge1xuICAgICAgaWYgKHBpY2tpbmcpIHtcbiAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNCh2Q29sb3IsIDEuMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2ZWM0IGZyb21UZXh0dXJlID0gdGV4dHVyZTJEKHRleHR1cmUsIHZVdik7XG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQodkNvbG9yLCAxLjApICogZnJvbVRleHR1cmU7XG4gICAgICB9XG4gICAgfWA7XG50eXBlIEdseXBoVGV4dHVyZSA9IHtcbiAgdGV4dHVyZTogVEhSRUUuVGV4dHVyZTtcbiAgbGVuZ3RoczogRmxvYXQzMkFycmF5O1xuICBvZmZzZXRzOiBGbG9hdDMyQXJyYXk7XG59O1xuLyoqXG4gKiBSZW5kZXJzIHRoZSB0ZXh0IGxhYmVscyBhcyAzZCBnZW9tZXRyeSBpbiB0aGUgd29ybGQuXG4gKi9cbmV4cG9ydCBjbGFzcyBzY2F0dGVyUGxvdFZpc3VhbGl6ZXJUcmlhbmdsZXMgaW1wbGVtZW50cyBTY2F0dGVyUGxvdFZpc3VhbGl6ZXIge1xuICBwcml2YXRlIHNjZW5lOiBUSFJFRS5TY2VuZTtcbiAgLy8gcHJpdmF0ZSBsYWJlbFN0cmluZ3M6IHN0cmluZ1tdO1xuICBwcml2YXRlIGdlb21ldHJ5OiBUSFJFRS5CdWZmZXJHZW9tZXRyeTtcbiAgcHJpdmF0ZSB3b3JsZFNwYWNlUG9pbnRQb3NpdGlvbnM6IEZsb2F0MzJBcnJheTtcbiAgcHJpdmF0ZSBwaWNraW5nQ29sb3JzOiBGbG9hdDMyQXJyYXk7XG4gIHByaXZhdGUgcmVuZGVyQ29sb3JzOiBGbG9hdDMyQXJyYXk7XG4gIHByaXZhdGUgbWF0ZXJpYWw6IFRIUkVFLlNoYWRlck1hdGVyaWFsO1xuICBwcml2YXRlIHVuaWZvcm1zOiBhbnk7XG4gIHByaXZhdGUgcG9pbnRzTWVzaDogVEhSRUUuTWVzaDtcbiAgcHJpdmF0ZSBwb3NpdGlvbnM6IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZTtcbiAgcHJpdmF0ZSB0b3RhbFZlcnRleENvdW50OiBudW1iZXI7XG4gIHByaXZhdGUgbGFiZWxWZXJ0ZXhNYXA6IG51bWJlcltdW107XG4gIHByaXZhdGUgZ2x5cGhUZXh0dXJlOiBHbHlwaFRleHR1cmU7XG4gIHByaXZhdGUgc2VsZWN0ZWRJbmRleExpc3Q6IG51bWJlcltdXG4gIHByaXZhdGUgdW5MYWJlbERhdGFJbmRleExpc3Q6IG51bWJlcltdXG4gIHByaXZhdGUgbGFiZWxzOiBMYWJlbFJlbmRlclBhcmFtcztcbiAgcHJpdmF0ZSBjcmVhdGVHbHlwaFRleHR1cmUoKTogR2x5cGhUZXh0dXJlIHtcbiAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY2FudmFzLndpZHRoID0gTUFYX0NBTlZBU19ESU1FTlNJT047XG4gICAgY2FudmFzLmhlaWdodCA9IEZPTlRfU0laRTtcbiAgICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3R4LmZvbnQgPSAnYm9sZCAnICsgRk9OVF9TSVpFICogMC43NSArICdweCByb2JvdG8nO1xuICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJztcbiAgICBjdHguZmlsbFN0eWxlID0gTEFCRUxfQkFDS0dST1VORDtcbiAgICBjdHgucmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LmZpbGxTdHlsZSA9IExBQkVMX0NPTE9SO1xuICAgIGxldCBzcGFjZU9mZnNldCA9IGN0eC5tZWFzdXJlVGV4dCgnICcpLndpZHRoO1xuICAgIC8vIEZvciBlYWNoIGxldHRlciwgc3RvcmUgbGVuZ3RoLCBwb3NpdGlvbiBhdCB0aGUgZW5jb2RlZCBpbmRleC5cbiAgICBsZXQgZ2x5cGhMZW5ndGhzID0gbmV3IEZsb2F0MzJBcnJheShOVU1fR0xZUEhTKTtcbiAgICBsZXQgZ2x5cGhPZmZzZXQgPSBuZXcgRmxvYXQzMkFycmF5KE5VTV9HTFlQSFMpO1xuICAgIGxldCBsZWZ0Q29vcmQgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNX0dMWVBIUzsgaSsrKSB7XG4gICAgICBsZXQgdGV4dCA9ICcgJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7XG4gICAgICBsZXQgdGV4dExlbmd0aCA9IGN0eC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aDtcbiAgICAgIGdseXBoTGVuZ3Roc1tpXSA9IHRleHRMZW5ndGggLSBzcGFjZU9mZnNldDtcbiAgICAgIGdseXBoT2Zmc2V0W2ldID0gbGVmdENvb3JkO1xuICAgICAgY3R4LmZpbGxUZXh0KHRleHQsIGxlZnRDb29yZCAtIHNwYWNlT2Zmc2V0LCAwKTtcbiAgICAgIGxlZnRDb29yZCArPSB0ZXh0TGVuZ3RoO1xuICAgIH1cbiAgICBjb25zdCB0ZXggPSB1dGlsLmNyZWF0ZVRleHR1cmUoY2FudmFzKTtcbiAgICByZXR1cm4geyB0ZXh0dXJlOiB0ZXgsIGxlbmd0aHM6IGdseXBoTGVuZ3Rocywgb2Zmc2V0czogZ2x5cGhPZmZzZXQgfTtcbiAgfVxuICBwcml2YXRlIHByb2Nlc3NMYWJlbFZlcnRzKHBvaW50Q291bnQ6IG51bWJlcikge1xuICAgIGxldCBudW1Ub3RhbExldHRlcnMgPSAwO1xuICAgIHRoaXMubGFiZWxWZXJ0ZXhNYXAgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvaW50Q291bnQ7IGkrKykge1xuICAgICAgY29uc3QgbGFiZWwgPSAnMTMnO1xuICAgICAgbGV0IHZlcnRzQXJyYXk6IG51bWJlcltdID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxhYmVsLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgVkVSVElDRVNfUEVSX0dMWVBIOyBrKyspIHtcbiAgICAgICAgICB2ZXJ0c0FycmF5LnB1c2gobnVtVG90YWxMZXR0ZXJzICogVkVSVElDRVNfUEVSX0dMWVBIICsgayk7XG4gICAgICAgIH1cbiAgICAgICAgbnVtVG90YWxMZXR0ZXJzKys7XG4gICAgICB9XG4gICAgICB0aGlzLmxhYmVsVmVydGV4TWFwLnB1c2godmVydHNBcnJheSk7XG4gICAgfVxuICAgIHRoaXMudG90YWxWZXJ0ZXhDb3VudCA9IG51bVRvdGFsTGV0dGVycyAqIFZFUlRJQ0VTX1BFUl9HTFlQSDtcbiAgfVxuICBwcml2YXRlIGNyZWF0ZUNvbG9yQnVmZmVycyhwb2ludENvdW50OiBudW1iZXIpIHtcbiAgICB0aGlzLnBpY2tpbmdDb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KFxuICAgICAgdGhpcy50b3RhbFZlcnRleENvdW50ICogUkdCX0VMRU1FTlRTX1BFUl9FTlRSWVxuICAgICk7XG4gICAgdGhpcy5yZW5kZXJDb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KFxuICAgICAgdGhpcy50b3RhbFZlcnRleENvdW50ICogUkdCX0VMRU1FTlRTX1BFUl9FTlRSWVxuICAgICk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludENvdW50OyBpKyspIHtcbiAgICAgIGxldCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcihpKTtcbiAgICAgIHRoaXMubGFiZWxWZXJ0ZXhNYXBbaV0uZm9yRWFjaCgoaikgPT4ge1xuICAgICAgICB0aGlzLnBpY2tpbmdDb2xvcnNbUkdCX0VMRU1FTlRTX1BFUl9FTlRSWSAqIGpdID0gY29sb3IucjtcbiAgICAgICAgdGhpcy5waWNraW5nQ29sb3JzW1JHQl9FTEVNRU5UU19QRVJfRU5UUlkgKiBqICsgMV0gPSBjb2xvci5nO1xuICAgICAgICB0aGlzLnBpY2tpbmdDb2xvcnNbUkdCX0VMRU1FTlRTX1BFUl9FTlRSWSAqIGogKyAyXSA9IGNvbG9yLmI7XG4gICAgICAgIHRoaXMucmVuZGVyQ29sb3JzW1JHQl9FTEVNRU5UU19QRVJfRU5UUlkgKiBqXSA9IDE7XG4gICAgICAgIHRoaXMucmVuZGVyQ29sb3JzW1JHQl9FTEVNRU5UU19QRVJfRU5UUlkgKiBqICsgMV0gPSAxO1xuICAgICAgICB0aGlzLnJlbmRlckNvbG9yc1tSR0JfRUxFTUVOVFNfUEVSX0VOVFJZICogaiArIDJdID0gMTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBhZGRiYWNrZ3JvdW5kSW1nKGltZ1VybDogc3RyaW5nKSB7XG4gICAgLy/np7vpmaTkuIrkuIDkuKrnlLvluINcbiAgICBpZiAod2luZG93LmJhY2tncm91bmRNZXNoKSB7XG4gICAgICB0aGlzLnNjZW5lLnJlbW92ZSh3aW5kb3cuYmFja2dyb3VuZE1lc2gpXG4gICAgfVxuICAgIGlmICghaW1nVXJsKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgLy8gMu+8jOS9v+eUqGNhbnZhc+eUu+WbvuS9nOS4uue6ueeQhui0tOWbvlxuICAgIC8vIOWFiOS9v+eUqGNhbnZhc+eUu+WbvlxuICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBjYW52YXMud2lkdGggPSAyMDA7XG4gICAgY2FudmFzLmhlaWdodCA9IDIwMDtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgaW1nLnNyYyA9IGltZ1VybDtcbiAgICBpbWcuY3Jvc3NPcmlnaW4gPSBcImFub255bW91c1wiO1xuICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgMjAwLCAyMDApO1xuICAgICAgbGV0IHRleHR1cmUgPSBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjYW52YXMpO1xuICAgICAgLy8gdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7IC8vIOS4jeiuvue9rm5lZWRzVXBkYXRl5Li6dHJ1ZeeahOivne+8jOWPr+iDvee6ueeQhui0tOWbvuS4jeWIt+aWsFxuICAgICAgdmFyIHBsYW5lX2dlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwgMik7XG4gICAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoe1xuICAgICAgICAvLyBjb2xvcjoweDExZmYyMixcbiAgICAgICAgbWFwOiB0ZXh0dXJlLFxuICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXG4gICAgICB9KTtcbiAgICAgIHdpbmRvdy5iYWNrZ3JvdW5kTWVzaCA9IG5ldyBUSFJFRS5NZXNoKHBsYW5lX2dlb21ldHJ5LCBtYXRlcmlhbCk7XG4gICAgICB0aGlzLnNjZW5lLmFkZCh3aW5kb3cuYmFja2dyb3VuZE1lc2gpO1xuICAgIH1cbiAgfVxuICBjcmVhdGVUcmlhbmdsZXMoKSB7XG4gICAgLy8gaWYgKHdpbmRvdy5zY2VuZUJhY2tncm91bmRJbWdbd2luZG93Lml0ZXJhdGlvbl0pIHtcbiAgICAvLyAgIHRoaXMuYWRkYmFja2dyb3VuZEltZygnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyB3aW5kb3cuc2NlbmVCYWNrZ3JvdW5kSW1nW3dpbmRvdy5pdGVyYXRpb25dKVxuICAgIC8vIH1cbiAgICAvLyB0aGlzLmFkZGJhY2tncm91bmRJbWcoJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRDRBQUFBd0NBWUFBQUJKeThrMEFBQUFBWE5TUjBJQXJzNGM2UUFBRDRkSlJFRlVhRU90V21sekk4bDF6RWFmNk1ZTmtzTzVRNUlqRktIL2JDbDgvQXo1MEEvd3JxVlBraTFyWTdYcm1aMFpEZ25pNnJ2aHlGZFYzZFVBeU9HdXpBMHVRSEFJTWl2ejVidksrZlZ2dnpvY3dBLzlmM2s0UUwrSWcvbnVRVjdWcjZ2SEJnYzRSNC9xbjZ2djgyZjUyY2lqK2xxZU4rYTFBK3BEZzRaZnkyc05hbm5lb0s0YlZQSllxNSsxL2tZSERod0hHQXdHY0FjREJMNkh3UFBrYTk4ZHdQYzlEQUNVVllXMHFGRFdOWXFxbHZmbDMrQUFjSDc5TDE5cGJGOEFUamo2THpBSFlJQUxJTDdaMGVNeGNIVUFmZUFDa2ovWHFBTVE0RHlBdWtiRnIrc2FqVDVNd2M3Zll3SDNYUmRoNEF0NGIrRENkUWNJNWJramdOTzhSRmFXS0tzYVJWbkp3VDhDWElOVTNNbHhxOSt0bWRPTUVyaWNvTERlQWU5VTBqRXJDam53eFBrMkdpUmZFeFlVMDFSQ3pZTm9EcWpxV2oydjViZDBmd04vRDlsMkhNV3c3MkVZK0FMZWR6MTRyaU92aGE0clA1L21oWUJQeXdwRlVjcjdFc3NEakQ4Q1hETnZwUDUwNEVyTzNRRlE1bHJpbW1YRk9BK2xRVlh6QURSd0hyaWhXd04zSEVka0h2aytvakFROEdUZDlRWUlYQTloNEFrcFdWNWluMm53Ulk3Y3NINWU2bDhHVG9hTmxBM2pOdFA4TzIxcDgwOVh3S2tDU0d6emlTMXovbnRLV3hodmFtRmJsR0FNUjhOWFVuZmdlYTRBSDBZRUhnaFlzaDI0THFJZ0VHVmtSWWsweTdGTmMreXlYTDVtQ0FqalNrbDJqUC90d1BsdTVtQnNNek1HUjhBMmNDVjF6ZktKMUR2RGxQaDBPdUJrT29sQ0FSOEdBU0l4T2hkaEdNQjFISlJsaFcyV1k1Tm1BbjZmS2RZdDRBKzR1WWx0NjFFQjZydTNVWUQ2WitvWXp3RTNLaEJaYTFQanYxTVM3NlJla3UxYXlaNC9ZMzhvNElEdmVZakRBUEV3UkJLR0dHckowOXpDMEJjUG9JSjJXWUg3WFNyZzkybUdMQzkrS25DakNDdE5HZGMvQTl4SS9EaWQ5V1d1Z1RPTjBmd3F1dnF4MUxXcmErQk1ZV1E3R1lhSUkvVkp5UTlEU3A1bU41Q0QyMmNsN3JZN3JIZDdBYytEY0g3RGRLWU11NSsvajkyOHg3eko2VjArTjNuNkhPTmRiS3Q0TlRMdlVwbG1tb0IxWERNT0RlTkdQWkxLTk9pQm8vSTN3WTdJK0RCcUpXOWNQdlFHS09zRDBxekEzWGFQdTgwV20zMktYU3JBdjFiQzdCVW9aOUxZL3lOd0EvZzR4dVYxT3JyTzMzUjJVM1FZcVIrWXl1Qkl2bGJHRm1JOEpQaElKTTlIU2o3eVhRUytMK21Mc2IzYTduR3pXbU85cDl6ekh3dmNQaENiYlpYTFRTSHpVSXdyRUNxZm42WXlTK3FTem95cjB6MVVuY0FQVm1UaTZBUWVxUGhXd0ljaStiRWNRSUNJZWQzM1VGZU5nRjF0ZC9oOHQ4SDliaThISVl5M0phWWRwMmVsYnJ2L1R3TnV5dGZUaWsyWm1GMnhHY1pWY2VUZzRCd3M0QzZHb2ErQlJ4akhReVJ4aElsbTN1UjFIdUQ5VmdHL3VkL2dmclBEWnAvQitjMi9mbjJ3NjNHcHpuUmRiTmZyeGxmdFhOM1czN3BtZndyakF1NG9sZGx1VHFrclIxZU1WMUlaZHE1K1lNVUc3ZWhSSUxGTmxwTmtLS0RIY1lUUk1FQWNoc0o0V1ZmWWJQYTQyMmI0dE41Z2RiOFYxaytCSHpVaXRsbVo1KzFyVm9QUzF1V1BwRE5LM0tReHhyZDZydUtZZWR4VWFuUnpJL1ZHTk42MFVxZk1CYmp2WVVRbjEvSWVKekVtQWpyQ0tBNlJSQkdpd0VOZVZWZ1QrQ2JGNTgwR24xY2JpZmZPM0pTcG4zUmdYd0orMG9rOUNseDNYcnBVQlFIcVhIN2NsVldWcXRVbGoxdEpmRUJyY3c3U2lKQnRPdm9vSGdyVEV5MzNjUnlLOUllK2o2S3FCS2dBWDI5d2M3ZVcxUFkwNEdmYlZGUHAyYm5jYWtmdEFzYlU1QWFrRGJ6dHh2ck5TV3R1SW5YV2F5YUhINlF3WVNvVGRvZWhBQjVSNm5Ha0RDNFpZaHJIaUtOQURtKzFZWHh2NWZQVGFvM2I5ZmJwd0UySGRseVAyM0Z1S3JvVFYvOFM4TFpVVmMySkZDNVZqWkk2MTNRYjNsbUdFamk3TVFLbm8wK1NvYkJPNExFOGhwZ21pVWllRmQ1NnU4ZjcyM3ZjcnJiNHNGcExXbXNMR08xbnZSYXdCV2s1L09QQXJUSzE3ZDlWYTZvR0RhcjFsTXFNbllyTzJkS05hVm1id3NWbTNDNVhHZCtlNTBtNk1pNHVoa2JBY2dCSzVyTWt4alNPNEhzRHJOTVU3ejdkNCtQZEJoL3YrR2dEdDZjYytybGQyRHlOOFVlQWEvQ1BBUmNYbHdGRXgzalhtWFVwamFVcW14SXkzanE1U0oyeFR1QXhwcU1oRmttSXlCOWdtMVo0ZDN1UDk3Y2IvSEM3d2crZlY3cFdiNDN0eTJYck9jYk5KSVpweXJpN2VMR0tnN1k5TmNPR2h4aHZnZXNEcUd0T2RocUpjV053cmJGSmphN1NGOU1aNDFxQUp5cW5FL2d5OFRIeUI5Z1ZEZDZ2VTd6L3RNTDNOM2Q0OStrbkFEZDUzczc5Tm5EbVhNblRaNEFidVN0Wm4wcWR3Q2wxWVYwM0tZZlcyQlIwdWpyN2JwcFlDNXpnQ1RhSkJmaVVzaWZ3b1lmRWM1QTN3TzIreEY4LzNlRzdqM2Y0L3RQbjArNU1sK1JIRFlzZU8xbjFlcitwNlE4WCs4RE55S21MY3dKWGVWelY1U2JHVytBRXJTV3ZnSGNKalhsYzllQ1J4TGlrTVVxZWpJOFUwNU00eG13Y1l4NE9FQTdVMkd4WDFQajI0eHJmZkxqRnR4OXZuZ3I4YU81MjBzMzFVNXFBc2tkVWV0Wm1lbXMxVmRVanBpOENOMmxUcFRSdkFCazRqQ1IxTVhjcjhFeGZrM0dFMlNpV3p3V05MblRnYTJmTTZnWi92ZG5oTHg5dThkMFA1NEJiSnRlV3JHZnFkc080R1RJK21OYXNJZU9QQmM2V1VvN1F5dU91NjBqM1pSb1RIc0JFNUUyV2g1aFB4MWlPWWl4akg2SExpYXo2cUJyZzNUckgvM3k0d2JmLyt3bk8rYm42a2NuWnc3NTJ1cUlkMFdLMlY2dTNSdGZOM2pyZ1pwYit1TlFaNzEyTUt3QStnVXNQcmswdERqRktZc3dKZGpiQzVXeU14U2pDSkJqQTR3OFF1WjRDMzJVMS92eitNLzc4L2NlSGdadFU5bERKMnAvVG5RNGsyckdUTUs2SGpIcU05RlNwSytEZEtvRlZldUFOTUF4WnBxb1dWR1ErU2pUb0thNm5DUmFhYlRrcEFTNERaYVJWZy8vNmNJZi8vcTVsWEhjL1oyVnVHVnR2dkhUS3VKcXpXN2xjeitaYTRMcHdNZlB6TDVsYlVhbk5SMWV1T2doOVZ6UE9ValVTSjE5TVIxak94bml4bU9KeUdtUGlxMFpHbVdLdDBYdGlwTjk4V3VPUDM5L0ErZnZmZnRYQmJYK0h0VUt5bk55d2J6OGE1dTF4Y3g5OHR6b3kzVm03T0pDTnljT3VUdUQyb0pGTEJBSTNIUm1kZkRraDZBbXU1Mk04djVqZ0lnNFF0S1Y5aXFiSlZSSWN4R2dPTHQ3ZlovZ1RZN3dGM3NMdnBpdzlvQThlZ0dMZUFPY2t4aTVrN0oyWmJGSk1PeXFybzRlQmwxVWpuVldQOFFGa21FamdMRmFXWTBwOGpNdjVCQytYTXp5YkRURU5YRzFvM0pWdFVkZGJZZHgxeDNBR01kYVpneisrRThiL3cyeUh0S0pPMlc1RmJabGNiM2hoclpSK0hIQk9YRXhhVStOa0tXQzQ1NnBybENYM1pwM1V5VGluTHV6SVpxTkVqT3h5UHNYejVSUXZ5WFlTU3Q2V2RlWWhSVjF2VUpaN0taWjhmd2pQVzZKQmlEKzl1OVhBSDJLN2w4YTAwNXZqTWFaalRXZVBsNGd5WGVWLzdRWkY5K1B0QU9JeDRCWEtVZzBmelFlN3NpVDBwVHhkVGhJOG04OXdmVEhIeTRzcG5zOWpURU8xSlQwY1NqVE5QY3FTd0RQVWRZWEJnSjNiTTdoZWdtOCtiaFZ3ZTE1dnU2aloxTFVMUS9NWG5HeGUrbXRqazliK0Z1QmM4VExHZThBZEI4a3drSmJ6YWo3R2krVU1MeTRYZUhVeHc3TnhpTWhUVmQ3aHNFTlJyRkNVVzFSbGdhcks0VGdlUnFOTCtQNGxmcml2ajRIYk11OXZLTnRabkFWYWgzMWIzcDR3YnEyRnplNk0walV0cUl5ZUhwQTZnZWNFWG90N3lKRnpTY2cwdGhpUGNMV1k0TlhsQXErZkxmRG1Zb1pwNU1KM3lEWWxmbzg4SitPNWZGWlZJWElmeGhNazhSdHN5K1NKd004d2JJTlcxVnQzVWFCbDNPclc1RFhka3o4Rk9HZGxqSEV5TGdiSmxSR0JqNGE0bW83d2ZEa1Q0RzhKZkRGQ0xLYkdBZVVXZWY0WlpibFR3S3NDbFpaN0VDU1lUbjhCSjdqb1hGM2V2RjJFMjB2RHgvSjQ1K2huZ1pzWWJ3c1lNNVJRbFp1NjhjQ1VwZGZDbHJrWjRESmloaG9yY3dBeEh3L3hUQXh0aHRkWEM3eTlYdURGWklqSUcrQ0FERlc1UXByZVNtd3J0dlZqWFdMZytGZ3VYeU1adiswRDcxVnB4c0Z0YVQvSy9CbkdiWFBUYTJJMWpUbmFrMG4vcmVKWnVUcGx6aHNNWkZCZEJXRlhGZ1ErTGlZeHJoZFRpVzJSK2VVY1Y2TUE0Y0JCMVd4UUZqZEkwN1VHYnNBcjVpbWJ5ZVFTeStYZkhRTTNOeDVPMjFCYjJ1ZGxmbm9WcExjZjF3T0poNEVyV1p0MFpvQXp0WkZ4ajVjQXdoQlhzd1RYV3VadnJwZDRkVFhETW5EaE9nZFUxUXBaOWhGNXRrTWhqS2NXOHptYXBzSndPTVBWNWE4VWNOdldld3NEdTJnNXc3YUpiWjA1MnlzaDVqM3NsWEE3ZDI5dlA1Z2RtYm41b0lhTE1vQ29EaklQbC9pVXNwVXlkNlVqWTdGQ04zOTV0Y1NiNndYZUxLY1kreXhSU3BUbEhkTDBCcGtOdkNCNGZ1YW9td3ErRitIcTZwZnN4NzgrVUhycW8zL2J5VTVqeDl0VTQrREhvSS9md3d3YTFZcFlWMjZ0c3l0WFY0c0VHM2l0Z0plcWtLRi9jSnpNRXZWNk1jR0x5emxlWGwzZzUxY3p2SjRuOEYzK0ZYdEpZZnYwRGxtMlJWRmtLQXUrUnViM090NUxPTTRBeStVck9QL3diLzk1WUh6eEFzN2ovZmY1VzFFUEhVQ1BkZTNtNTJ0MWM2MnJYN2tST0dOY2RXaVFuZmQ4bk9ENVlvYVhsM084dXI3QXp5OW51SjZFY0NXTkVld2Q5dWs5c25TRHZOaWpMRklVQkUvRzVRQnlLYTRuNHlXY2YvcmQ3dzlxeUtjNm9aTmJUbCtvMVBqdDQxdFAzWFpGYjJhT2dKdTJWQzMrOVdmVktLbWJrbFVENS8wME9qcDc4TXNwNDNzdWJzNzRmbnN4d3pMMk1IQ28xRFh5bkZLL1IwcmcrUTQ1WlY3czlXT0dxbUtPcnhDR0NaeC8vdDBmRG1wTHlaT3ZWWG41eE5qdUx2aDF4bmJjd2NsUy93aTRHVFllWCtTVFpZSUFaNHdYS0ZpeTFqWHZkbUVjUmJpYWovRGlZbzVYVjB1OGZYNkIxOHNKcGdHdkFqRWxycEZuaHZGN1pQa2VlVTdnM1FHbzhyWEFZQkNROFQrSWJVbGUxUnRLc3ducGcranFWUk1TcHYvbXo1L2VmT284UThXM2luR1R2OXRGb1lseHZUa3hqRlBxZVZualVEZHdYUmVUSk1RMTgvZmxIRzhKL01VU3IyWWpSREplWWllbUdOL3Z5ZmdhV2I1Rm5qSEdXYjZtV3ZvRVRybWpBeTZiVzUxT0dwbDFkZGVzK3ZNMSt5cW5PZ3h6by9GOEhkQmQ2VHdQWEsrRGFXNHQ0N1dBNW8xRS9tN2VaT0k4allYTFMxWnIxMHY4NHRrQzE5T2h4RGRRU1ZPU1pTdnM5elE0UHQ4aEY1TmpuSGVzczN3bEVSTGo3WlpFcjJwRml2cEc0VU51cnZKQXgzUlBIU1pVMnUxcmQ3R3ZWNStiZTIwYXNBQW44OEoySThENU81SW9rSUhEczRVQnJoejljaFRvM3RzQXY4VnVSOGI1eWRLVkpwZWkwUEZPbzJQVFFpTjMvdkhmZjY5RHV0dCttbGd6QXdYSzJCaldZNERQRlRsR09YYXQzalVtNWdhRUJxeU5qVU9JdENxa0xlV1NrRmM3cmpobFdVN3hXdkwzQlg2Mm5HQTJsRHpHNjdyU21HU1pBcjdmcjVHUjlWd3hUcU5Uek85UlZqa09UYVdBSHhjdzBrSHBXd25pd0QxbSs3bGVIVWs3YU5jNmFGOXN2NmNXSjJxVVpKdWFLVlZacGhJdzA1ZVJPUStJVjdZNFc3dGltWG94RTJQNzJmTUx2SnlPTUFxTTd4RDRDbWwyaS8xdWhaMkpjNUg2RGtXdTA1b3VadXFtVm5uOGhDbDJ0ZVkrS1V0R3VaVjg1ckx1a2Z0M04yVDBKWU4yd3FrR25lWnF0dktTL3AxVm1icG9tV2RGZFJUZnVqJylcblxuICAgIGlmICghd2luZG93LmN1c3RvbVNlbGVjdGlvbikge1xuICAgICAgd2luZG93LmN1c3RvbVNlbGVjdGlvbiA9IFtdXG4gICAgfSBlbHNlIHtcblxuICAgICAgZnVuY3Rpb24gZnVuYyhhLCBiKSB7XG4gICAgICAgIHJldHVybiBhIC0gYjtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5jdXN0b21TZWxlY3Rpb24uc29ydChmdW5jKVxuICAgICAgY29uc29sZS5sb2coJ2N1c2N1cycsIHdpbmRvdy5jdXN0b21TZWxlY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoIXRoaXMudW5MYWJlbERhdGFJbmRleExpc3QpIHtcbiAgICAgIHRoaXMudW5MYWJlbERhdGFJbmRleExpc3QgPSBbXVxuICAgIH1cbiAgICB3aW5kb3cuc2VsZWN0ZWRMaXN0ID0gdGhpcy5zZWxlY3RlZEluZGV4TGlzdFxuICAgIGlmICh0aGlzLndvcmxkU3BhY2VQb2ludFBvc2l0aW9ucyA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHBvaW50Q291bnQgPVxuICAgICAgdGhpcy53b3JsZFNwYWNlUG9pbnRQb3NpdGlvbnM/Lmxlbmd0aCAvIFhZWl9FTEVNRU5UU19QRVJfRU5UUlk7XG4gICAgdGhpcy5nbHlwaFRleHR1cmUgPSB0aGlzLmNyZWF0ZUdseXBoVGV4dHVyZSgpO1xuICAgIHRoaXMudW5pZm9ybXMgPSB7XG4gICAgICB0ZXh0dXJlOiB7IHR5cGU6ICd0JyB9LFxuICAgICAgcGlja2luZzogeyB0eXBlOiAnYm9vbCcgfSxcbiAgICB9O1xuICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoe1xuICAgICAgdW5pZm9ybXM6IHRoaXMudW5pZm9ybXMsXG4gICAgICB0cmFuc3BhcmVudDogdHJ1ZSxcbiAgICAgIHZlcnRleFNoYWRlcjogVkVSVEVYX1NIQURFUixcbiAgICAgIGZyYWdtZW50U2hhZGVyOiBGUkFHTUVOVF9TSEFERVIsXG4gICAgfSk7XG4gICAgdGhpcy5wcm9jZXNzTGFiZWxWZXJ0cyhwb2ludENvdW50KTtcbiAgICB0aGlzLmNyZWF0ZUNvbG9yQnVmZmVycyhwb2ludENvdW50KTtcbiAgICBsZXQgcG9zaXRpb25BcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoXG4gICAgICB0aGlzLnRvdGFsVmVydGV4Q291bnQgKiBYWVpfRUxFTUVOVFNfUEVSX0VOVFJZXG4gICAgKTtcbiAgICB0aGlzLnBvc2l0aW9ucyA9IG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoXG4gICAgICBwb3NpdGlvbkFycmF5LFxuICAgICAgWFlaX0VMRU1FTlRTX1BFUl9FTlRSWVxuICAgICk7XG4gICAgbGV0IHBvc0FycmF5ID0gbmV3IEZsb2F0MzJBcnJheShcbiAgICAgIHRoaXMudG90YWxWZXJ0ZXhDb3VudCAqIFhZWl9FTEVNRU5UU19QRVJfRU5UUllcbiAgICApO1xuICAgIGxldCBjb2xvcnNBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoXG4gICAgICB0aGlzLnRvdGFsVmVydGV4Q291bnQgKiBSR0JfRUxFTUVOVFNfUEVSX0VOVFJZXG4gICAgKTtcbiAgICBsZXQgcG9zaXRpb25PYmplY3QgPSBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKHBvc0FycmF5LCAyKTtcbiAgICBsZXQgY29sb3JzID0gbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZShjb2xvcnNBcnJheSwgUkdCX0VMRU1FTlRTX1BFUl9FTlRSWSk7XG4gICAgdGhpcy5nZW9tZXRyeSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpO1xuICAgIHRoaXMuZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCdwb3NPYmonLCBwb3NpdGlvbk9iamVjdCk7XG4gICAgdGhpcy5nZW9tZXRyeS5hZGRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgdGhpcy5wb3NpdGlvbnMpO1xuICAgIHRoaXMuZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCdjb2xvcicsIGNvbG9ycyk7XG4gICAgbGV0IGxldHRlcnNTb0ZhciA9IDA7XG4gICAgY29uc29sZS5sb2coJ3NlbGVjdGVkSW5kZXhMaXN0JywgdGhpcy5zZWxlY3RlZEluZGV4TGlzdCwgdGhpcy5nbHlwaFRleHR1cmUpXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludENvdW50ICogMjsgaSsrKSB7XG4gICAgICBsZXQgbGVmdE9mZnNldCA9IDA7XG4gICAgICBsZWZ0T2Zmc2V0ICs9IHRoaXMuZ2x5cGhUZXh0dXJlLmxlbmd0aHNbMTA1XTtcbiAgICAgIC8vIERldGVybWluZSBsZW5ndGggb2Ygd29yZCBpbiBwaXhlbHMuXG4gICAgICBsZWZ0T2Zmc2V0IC89IC0yOyAvLyBjZW50ZXJzIHRleHQgaG9yaXpvbnRhbGx5IGFyb3VuZCB0aGUgb3JpZ2luXG4gICAgICBsZXQgbGV0dGVyV2lkdGggPSB0aGlzLmdseXBoVGV4dHVyZS5sZW5ndGhzWzEwNV07XG4gICAgICBsZXQgc2NhbGUgPSBGT05UX1NJWkU7XG4gICAgICBsZXQgcmlnaHQgPSAobGVmdE9mZnNldCArIGxldHRlcldpZHRoKSAvIHNjYWxlO1xuICAgICAgbGV0IHRyaVJpZ2h0ID0gKGxlZnRPZmZzZXQgKyB0aGlzLmdseXBoVGV4dHVyZS5sZW5ndGhzWzExNV0pIC8gc2NhbGU7XG4gICAgICBsZXQgbGVmdCA9IGxlZnRPZmZzZXQgLyBzY2FsZTtcbiAgICAgIGxldCB0b3AgPSA0MCAvIHNjYWxlO1xuICAgICAgaWYgKHdpbmRvdy51bkxhYmVsRGF0YS5pbmRleE9mKE1hdGguZmxvb3IoaSAvIDIpKSAhPT0gLTEpIHtcbiAgICAgICAgcG9zaXRpb25PYmplY3Quc2V0WFkobGV0dGVyc1NvRmFyICogVkVSVElDRVNfUEVSX0dMWVBIICsgMCwgbGVmdCwgbGVmdCk7XG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDEsIC1sZWZ0LCBsZWZ0KTtcbiAgICAgICAgcG9zaXRpb25PYmplY3Quc2V0WFkobGV0dGVyc1NvRmFyICogVkVSVElDRVNfUEVSX0dMWVBIICsgMiwgMCwgdG9wIC8gNCk7XG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDAsIGxlZnQsIGxlZnQpO1xuICAgICAgICBwb3NpdGlvbk9iamVjdC5zZXRYWShsZXR0ZXJzU29GYXIgKiBWRVJUSUNFU19QRVJfR0xZUEggKyAxLCAtbGVmdCwgbGVmdCk7XG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDIsIDAsIHRvcCAvIDQpO1xuICAgICAgfSBlbHNlIGlmICh3aW5kb3cudGVzdGluZ0RhdGEuaW5kZXhPZihNYXRoLmZsb29yKGkgLyAyKSkgIT09IC0xKSB7XG4gICAgICAgIC8vanV4aW5nXG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDAsIGxlZnQgLyAyLCBsZWZ0IC8gMik7XG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDEsIC1sZWZ0IC8gMiwgbGVmdCAvIDIpO1xuICAgICAgICBwb3NpdGlvbk9iamVjdC5zZXRYWShsZXR0ZXJzU29GYXIgKiBWRVJUSUNFU19QRVJfR0xZUEggKyAyLCBsZWZ0IC8gMiwgLWxlZnQgLyAyKTtcbiAgICAgICAgcG9zaXRpb25PYmplY3Quc2V0WFkobGV0dGVyc1NvRmFyICogVkVSVElDRVNfUEVSX0dMWVBIICsgMywgbGVmdCAvIDIsIC1sZWZ0IC8gMik7XG4gICAgICAgIHBvc2l0aW9uT2JqZWN0LnNldFhZKGxldHRlcnNTb0ZhciAqIFZFUlRJQ0VTX1BFUl9HTFlQSCArIDQsIC1sZWZ0IC8gMiwgbGVmdCAvIDIpO1xuICAgICAgICBwb3NpdGlvbk9iamVjdC5zZXRYWShsZXR0ZXJzU29GYXIgKiBWRVJUSUNFU19QRVJfR0xZUEggKyA1LCAtbGVmdCAvIDIsIC1sZWZ0IC8gMik7XG4gICAgICB9XG5cbiAgICAgIGxldHRlcnNTb0ZhcisrO1xuICAgICAgbGVmdE9mZnNldCArPSBsZXR0ZXJXaWR0aDtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvaW50Q291bnQ7IGkrKykge1xuICAgICAgY29uc3QgcCA9IHV0aWwudmVjdG9yM0Zyb21QYWNrZWRBcnJheSh0aGlzLndvcmxkU3BhY2VQb2ludFBvc2l0aW9ucywgaSk7XG4gICAgICB0aGlzLmxhYmVsVmVydGV4TWFwW2ldLmZvckVhY2goKGopID0+IHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbnMuc2V0WFlaKGosIHAueCwgcC55LCBwLnopO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMucG9pbnRzTWVzaCA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpO1xuICAgIHRoaXMucG9pbnRzTWVzaC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7XG4gXG4gICAgdGhpcy5zY2VuZS5hZGQodGhpcy5wb2ludHNNZXNoKTtcbiAgfVxuICBwcml2YXRlIGNvbG9yTGFiZWxzKHBvaW50Q29sb3JzOiBGbG9hdDMyQXJyYXkpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmdlb21ldHJ5ID09IG51bGwgfHxcbiAgICAgIHBvaW50Q29sb3JzID09IG51bGxcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29sb3JzID0gdGhpcy5nZW9tZXRyeS5nZXRBdHRyaWJ1dGUoJ2NvbG9yJykgYXMgVEhSRUUuQnVmZmVyQXR0cmlidXRlO1xuICAgIChjb2xvcnMgYXMgYW55KS5zZXRBcnJheSh0aGlzLnJlbmRlckNvbG9ycyk7XG4gICAgY29uc3QgbiA9IHBvaW50Q29sb3JzLmxlbmd0aCAvIFhZWl9FTEVNRU5UU19QRVJfRU5UUlk7XG4gICAgbGV0IHNyYyA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHtcbiAgICAgIGNvbnN0IGMgPSBuZXcgVEhSRUUuQ29sb3IoXG4gICAgICAgIHBvaW50Q29sb3JzW3NyY10sXG4gICAgICAgIHBvaW50Q29sb3JzW3NyYyArIDFdLFxuICAgICAgICBwb2ludENvbG9yc1tzcmMgKyAyXVxuICAgICAgKTtcbiAgICAgIGNvbnN0IG0gPSB0aGlzLmxhYmVsVmVydGV4TWFwW2ldLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbTsgKytqKSB7XG4gICAgICAgIGNvbG9ycy5zZXRYWVoodGhpcy5sYWJlbFZlcnRleE1hcFtpXVtqXSwgYy5yLCBjLmcsIGMuYik7XG4gICAgICB9XG4gICAgICBzcmMgKz0gUkdCX0VMRU1FTlRTX1BFUl9FTlRSWTtcbiAgICB9XG4gICAgY29sb3JzLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgfVxuICBzZXRTY2VuZShzY2VuZTogVEhSRUUuU2NlbmUpIHtcbiAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gIH1cbiAgLyoqIFNldCB0aGUgbGFiZWxzIHRvIHJlbmRlcmVkICovXG4gIHNldExhYmVscyhsYWJlbHM6IExhYmVsUmVuZGVyUGFyYW1zKSB7XG4gICAgdGhpcy5sYWJlbHMgPSBsYWJlbHM7XG4gIH1cbiAgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5wb2ludHNNZXNoKSB7XG4gICAgICBpZiAodGhpcy5zY2VuZSkge1xuICAgICAgICB0aGlzLnNjZW5lLnJlbW92ZSh0aGlzLnBvaW50c01lc2gpO1xuICAgICAgfVxuICAgICAgdGhpcy5wb2ludHNNZXNoID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMuZ2VvbWV0cnkpIHtcbiAgICAgIHRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpO1xuICAgICAgdGhpcy5nZW9tZXRyeSA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLmdseXBoVGV4dHVyZSAhPSBudWxsICYmIHRoaXMuZ2x5cGhUZXh0dXJlLnRleHR1cmUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5nbHlwaFRleHR1cmUudGV4dHVyZS5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmdseXBoVGV4dHVyZS50ZXh0dXJlID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgb25QaWNraW5nUmVuZGVyKHJjOiBSZW5kZXJDb250ZXh0KSB7XG4gICAgaWYgKHRoaXMuZ2VvbWV0cnkgPT0gbnVsbCkge1xuICAgICAgdGhpcy5jcmVhdGVUcmlhbmdsZXMoKVxuICAgIH1cbiAgICBpZiAodGhpcy5nZW9tZXRyeSA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMudGV4dHVyZS52YWx1ZSA9IHRoaXMuZ2x5cGhUZXh0dXJlLnRleHR1cmU7XG4gICAgdGhpcy5tYXRlcmlhbC51bmlmb3Jtcy5waWNraW5nLnZhbHVlID0gdHJ1ZTtcbiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdlb21ldHJ5LmdldEF0dHJpYnV0ZSgnY29sb3InKSBhcyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGU7XG4gICAgKGNvbG9ycyBhcyBhbnkpLnNldEFycmF5KHRoaXMucGlja2luZ0NvbG9ycyk7XG4gICAgY29sb3JzLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgfVxuICBvblJlbmRlcihyYzogUmVuZGVyQ29udGV4dCkge1xuICAgIGlmICh0aGlzLmdlb21ldHJ5ID09IG51bGwpIHtcbiAgICAgIHRoaXMuY3JlYXRlVHJpYW5nbGVzKClcbiAgICB9XG4gICAgaWYgKHRoaXMuZ2VvbWV0cnkgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmNvbG9yTGFiZWxzKHJjLnBvaW50Q29sb3JzKTtcbiAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnRleHR1cmUudmFsdWUgPSB0aGlzLmdseXBoVGV4dHVyZS50ZXh0dXJlO1xuICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMucGlja2luZy52YWx1ZSA9IGZhbHNlO1xuICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCdjb2xvcicpIGFzIFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZTtcbiAgICAoY29sb3JzIGFzIGFueSkuc2V0QXJyYXkodGhpcy5yZW5kZXJDb2xvcnMpO1xuICAgIGNvbG9ycy5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gIH1cbiAgb25Qb2ludFBvc2l0aW9uc0NoYW5nZWQobmV3UG9zaXRpb25zOiBGbG9hdDMyQXJyYXkpIHtcbiAgICB0aGlzLndvcmxkU3BhY2VQb2ludFBvc2l0aW9ucyA9IG5ld1Bvc2l0aW9ucztcbiAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgfVxuICAvLyBzZXRMYWJlbFN0cmluZ3MobGFiZWxTdHJpbmdzOiBzdHJpbmdbXSkge1xuICAvLyAgIHRoaXMubGFiZWxTdHJpbmdzID0gbGFiZWxTdHJpbmdzO1xuICAvLyAgIHRoaXMuZGlzcG9zZSgpO1xuICAvLyB9XG4gIHNldFNlbGVjdGVkUG9pbnQoc2VsZWN0ZWRJbmRleExpc3Q6IG51bWJlcltdKSB7XG4gICAgdGhpcy5zZWxlY3RlZEluZGV4TGlzdCA9IHNlbGVjdGVkSW5kZXhMaXN0XG4gIH1cbiAgc2V0VW5MYWJlbGVkSW5kZXgobGlzdDogbnVtYmVyW10pIHtcbiAgICB0aGlzLnVuTGFiZWxEYXRhSW5kZXhMaXN0ID0gbGlzdFxuICB9XG4gIG9uUmVzaXplKG5ld1dpZHRoOiBudW1iZXIsIG5ld0hlaWdodDogbnVtYmVyKSB7IH1cbn1cbiJdfQ==